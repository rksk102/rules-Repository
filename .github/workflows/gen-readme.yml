name: "4. Generate README"

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  docs:
    # ä»…åœ¨ Merge æˆåŠŸåè¿è¡Œ
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch' }}
    runs-on: ubuntu-latest
    name: "ğŸ“ Update Documentation"
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
        with:
          ref: main
          fetch-depth: 0 # è·å–å®Œæ•´å†å²ä»¥ç¡®ä¿ Git ä¿¡æ¯æ­£ç¡®

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸš€ Generate README
        run: |
          python3 scripts/gen_readme.py

      - name: ğŸ’¾ Commit & Push
        run: |
          git config user.name 'GitHub Actions Bot'
          git config user.email 'actions@github.com'
          
          # æ£€æŸ¥æ˜¯å¦æœ‰å˜åŠ¨ï¼Œé¿å…ç©ºæäº¤
          if [[ -n $(git status -s README.md) ]]; then
            git add README.md
            git commit -m "docs: update README with latest rules [skip ci]"
            git push
          else
            echo "::notice::README is up to date."
          fi
