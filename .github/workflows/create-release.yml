name: "4. Release SRS"

on:
  # âœ… åªæ¥å—æ€»æŒ‡æŒ¥æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

permissions:
  contents: write  # å¿…é¡»èµ‹äºˆå†™æƒé™æ‰èƒ½å‘å¸ƒ Release

jobs:
  pack-and-ship:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Scripts
        uses: actions/checkout@v4

      # ğŸ”¥ å…³é”®æ­¥éª¤ï¼šä¸‹è½½ä¹‹å‰æ­¥éª¤ç”Ÿæˆçš„ merged-rules æ–‡ä»¶å¤¹
      # å‰æï¼šä½ åœ¨ Step 2 (merge-rules.yml) ä¸­å¿…é¡»å·²ç» upload äº†åä¸º 'merged-rules-collection' çš„ artifact
- name: ğŸ“¦ Download Rules from Merge Workflow
        uses: dawidd6/action-download-artifact@v6
        with:
          # 1. è¿™é‡Œå¡«ä½  Merge å·¥ä½œæµçš„æ–‡ä»¶å (æˆ–è€…å·¥ä½œæµ name)
          workflow: merge-rules.yml 
          
          # 2. è¿™é‡Œå¡«ä½ åœ¨ Merge æ­¥éª¤é‡Œ upload çš„åå­—
          name: merged_rules_artifact
          
          # 3. ä¸‹è½½åˆ°å“ªé‡Œ
          path: merged-rules
          
          # 4. åªè¦æœ€æ–°çš„æˆåŠŸè®°å½• (è‡ªåŠ¨å¯»æ‰¾ä¸Šä¸€æ­¥ Merge çš„ç»“æœ)
          search_artifacts: true
          workflow_conclusion: success

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸš€ Run Release Script
        env:
          GH_TOKEN: ${{ github.token }}  # è„šæœ¬å†…éƒ¨è°ƒç”¨ gh å‘½ä»¤éœ€è¦ token
        run: |
          chmod +x scripts/release_handler.py
          python3 scripts/release_handler.py
