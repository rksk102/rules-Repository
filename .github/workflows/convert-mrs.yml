name: "3. Convert to MRS"

on:
  workflow_dispatch:

jobs:
  convert-job:
    name: "ğŸ¦„ Convert & Compile"
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Scripts
        uses: actions/checkout@v4

      - name: ğŸ“¦ Download Source (TXT)
        uses: dawidd6/action-download-artifact@v6
        with:
          workflow: merge-rules.yml
          name: merged_rules_artifact
          path: merged-rules
          search_artifacts: true
          workflow_conclusion: success

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: â¬‡ï¸ Install Python Deps
        run: pip install requests

      - name: ğŸš€ Run Conversion Script
        env:
          # å…³é”®ï¼šä¼ é€’ Token ç»™è„šæœ¬ï¼Œç”¨äºæ— é™æµè·å– Latest Release API
          GH_TOKEN: ${{ github.token }}
        run: |
          # èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™
          chmod +x scripts/convert_mrs.py
          # è¿è¡Œï¼Œå¹¶ç¡®ä¿æ—¥å¿—æµå®æ—¶åˆ·æ–°
          python3 -u scripts/convert_mrs.py

      - name: ğŸ“¤ Upload Result (MRS)
        uses: actions/upload-artifact@v4
        with:
          name: mrs_rules_artifact
          path: merged-rules-mrs/
          retention-days: 1
