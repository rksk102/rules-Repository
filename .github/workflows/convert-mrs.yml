name: "3. Convert to MRS"

on:
  workflow_dispatch:

jobs:
  convert-job:
    name: "ğŸ¦„ Convert & Compile"
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Scripts & Rules
        uses: actions/checkout@v4
        # è¿™ä¸€æ­¥ä¼šè‡ªåŠ¨æŠŠä½ ä»“åº“é‡Œçš„ merged-rules æ–‡ä»¶å¤¹ï¼ˆå’Œä½ åˆ é™¤æ–‡ä»¶åçš„çŠ¶æ€ï¼‰æ‹‰å–ä¸‹æ¥

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: â¬‡ï¸ Install Python Deps
        run: pip install requests

      - name: ğŸš€ Run Conversion Script
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          chmod +x scripts/convert_mrs.py
          # è„šæœ¬ä¼šé»˜è®¤åœ¨å½“å‰ç›®å½•ä¸‹å¯»æ‰¾ merged-rules æ–‡ä»¶å¤¹
          # å¹¶ä¸”ä¼šè‡ªåŠ¨ä¿ç•™å­ç›®å½•ç»“æ„è¾“å‡ºåˆ° merged-rules-mrs
          python3 -u scripts/convert_mrs.py

      - name: ğŸ“¤ Upload Result (MRS)
        uses: actions/upload-artifact@v4
        with:
          name: mrs_rules_artifact
          path: merged-rules-mrs/
          retention-days: 1

      - name: ğŸ’¾ Commit & Push to Repo
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ¤– Auto-generated MRS rules [skip ci]"
          file_pattern: merged-rules-mrs/
          branch: main
          skip_dirty_check: false
          commit_user_name: "github-actions[bot]"
          commit_user_email: "github-actions[bot]@users.noreply.github.com"
