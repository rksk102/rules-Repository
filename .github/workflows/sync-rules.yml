name: "1. Manage Rules: Sync & Sanitize"

on:
  workflow_dispatch:
    inputs:
      strict_mode:
        description: 'Strict Mode (Stop immediately on error)'
        required: false
        default: true
        type: boolean

permissions:
  contents: write

concurrency:
  group: sync-rules
  cancel-in-progress: true

jobs:
  sync-manager:
    name: "ğŸ›¡ï¸ Sync & Sanitize Rules"
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ—ï¸ Initialize Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ Setup Python Environment
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: ğŸ“¦ Install Dependencies
        run: |
          pip install requests
          # æˆ–è€…å¦‚æœä½ åˆ›å»ºäº† requirements.txt:
          # pip install -r requirements.txt

      - name: ğŸš€ Execute Python Sync
        id: run_sync
        env:
          STRICT_MODE: ${{ inputs.strict_mode }}
          TERM: xterm-color
        run: |
          # å‡è®¾ main.py å’Œ processor.py éƒ½åœ¨æ ¹ç›®å½•ï¼Œæˆ–è€…å¯¹åº” scripts ç›®å½•
          # è¿™é‡Œå‡è®¾ä½ æŠŠå®ƒä»¬æ”¾åœ¨äº† scripts/ ç›®å½•ä¸‹ï¼š
          export PYTHONPATH=$PYTHONPATH:$(pwd)/scripts
          python scripts/main.py
